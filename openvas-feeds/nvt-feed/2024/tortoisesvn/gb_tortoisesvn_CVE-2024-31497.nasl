# SPDX-FileCopyrightText: 2024 Greenbone AG
# Some text descriptions might be excerpted from (a) referenced
# source(s), and are Copyright (C) by the respective right holder(s).
#
# SPDX-License-Identifier: GPL-2.0-only

if(description)
{
  script_oid("1.3.6.1.4.1.25623.1.0.129013");
  script_version("2024-11-28T05:05:41+0000");
  script_tag(name:"last_modification", value:"2024-11-28 05:05:41 +0000 (Thu, 28 Nov 2024)");
  script_tag(name:"creation_date", value:"2024-11-11 09:00:00 +0200 (Mon, 11 Nov 2024)");
  script_tag(name:"cvss_base", value:"5.4");
  script_tag(name:"cvss_base_vector", value:"AV:N/AC:H/Au:N/C:C/I:N/A:N");
  script_tag(name:"severity_vector", value:"CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N");
  script_tag(name:"severity_origin", value:"NVD");
  script_tag(name:"severity_date", value:"2024-05-10 14:33:55 +0000 (Fri, 10 May 2024)");

  script_tag(name:"qod_type", value:"registry");
  script_tag(name:"solution_type", value:"VendorFix");

  script_cve_id("CVE-2024-31497");

  script_name("TortoiseSVN < 1.14.7 Weak PRNG Vulnerability");

  script_category(ACT_GATHER_INFO);

  script_copyright("Copyright (C) 2024 Greenbone AG");
  script_family("General");
  script_dependencies("gb_tortoise_svn_detect.nasl");
  script_mandatory_keys("tortoisesvn/detected");

  script_tag(name:"summary", value:"TortoiseSVN < 1.14.6 contains a vulnerable version of Putty");

  script_tag(name:"vuldetect", value:"Checks if a vulnerable version is present on the target host.");

  script_tag(name:"insight", value:"It was discovered that Putty 0.68 through 0.80 before 0.81,
  which is included in TortoiseSVN, uses biased ECDSA nonce generation, which allows an
  attacker to recover a user's NIST P-521 secret key via a quick attack in approximately 60
  signatures. An adversary may already have enough signature information to compromise a victim's
  private key, even if there is no further use of vulnerable PuTTY versions.");

  script_tag(name:"impact", value:"This allows for full secret key recovery of NIST P-521 keys
  after a malicious actor has seen roughly 60 valid ECDSA signatures generated by any PuTTY
  component under the same key. Client signatures are transmitted within the secure channel of SSH,
  requiring a malicious server to acquire such signatures. If the key has been used to sign
  arbitrary data (e.g., git commits by forwarding Pageant to a development host), the publicly
  available signatures (e.g., on GitHub) can be used as well.
  All NIST P-521 client keys used with PuTTY must be considered compromised, given that the attack
  can be carried out even after the root cause has been fixed in the source code (assuming that
  ~60 pre-patch signatures are available to an adversary).");

  script_tag(name:"affected", value:"TortoiseSVN prior to version 1.14.7.");

  script_tag(name:"solution", value:"Update to version 1.14.7 or later and revoke / re-create all
  generated key material.");

  script_xref(name:"URL", value:"https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/vuln-p521-bias.html");
  script_xref(name:"URL", value:"https://www.openwall.com/lists/oss-security/2024/04/15/6");
  script_xref(name:"URL", value:"https://tortoisesvn.net/Changelog.txt");

  exit(0);
}

include( "host_details.inc" );
include( "version_func.inc" );

CPE = "cpe:/a:tortoisesvn:tortoisesvn";

if( ! infos = get_app_version_and_location( cpe: CPE, exit_no_version: TRUE ) )
  exit( 0 );

version = infos["version"];
location = infos["location"];

if( version_is_less( version: version, test_version: "1.14.7" ) ) {
  report = report_fixed_ver( installed_version: version, fixed_version: "See advisory", install_path: location );
  security_message( port: 0, data: report );
  exit( 0 );
}

exit( 99 );
